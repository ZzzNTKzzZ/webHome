<section class="panel">
  <div class="panel-header">
    <h2>My Tasks</h2>
    <form action="/add" method="POST" class="add-form">
      <input name="title" placeholder="Add a new task..." required />
      <input type="date" name="dueDate" class="small" />
      <select name="priority" class="small">
        <option value="low">Low</option>
        <option value="normal" selected>Normal</option>
        <option value="high">High</option>
      </select>
      <button class="btn">Add</button>
    </form>
  </div>

  <div class="tasks">
    {{#if tasks.length}}
      {{#each tasks}}
        <article class="task {{#if completed}}completed{{/if}} priority-{{priority}}">
          <div class="left">
            <form action="/toggle/{{id}}" method="POST" class="inline-form">
              <button class="icon-btn" title="Toggle complete">✔</button>
            </form>
            <div class="task-body">
              <h3 class="task-title">{{title}}</h3>
              <div class="meta">
                {{#if dueDate}}<span>Due: {{dueDate}}</span>{{/if}}
                <span>· Created {{createdAt}}</span>
                <span class="tag">{{priority}}</span>
              </div>
            </div>
          </div>

          <div class="actions">
            <button class="btn-small edit-btn" data-id="{{id}}" data-title="{{title}}" data-due="{{dueDate}}" data-priority="{{priority}}">Edit</button>

            <form action="/delete/{{id}}" method="POST" onsubmit="return confirm('Delete this task?');" style="display:inline">
              <button class="btn-small danger">Delete</button>
            </form>
          </div>

          <form class="edit-form" action="/edit/{{id}}" method="POST" style="display:none;">
            <input name="title" value="{{title}}" required />
            <input type="date" name="dueDate" value="{{dueDate}}" class="small" />
            <select name="priority" class="small">
              <option value="low" {{#ifCond priority '==' 'low'}}selected{{/ifCond}}>Low</option>
              <option value="normal" {{#ifCond priority '==' 'normal'}}selected{{/ifCond}}>Normal</option>
              <option value="high" {{#ifCond priority '==' 'high'}}selected{{/ifCond}}>High</option>
            </select>
            <button class="btn-small">Save</button>
            <button type="button" class="btn-small outline cancel-edit">Cancel</button>
          </form>
        </article>
      {{/each}}
    {{else}}
      <p class="empty">No tasks yet — add your first task ✨</p>
    {{/if}}
  </div>
</section>

<script>
  // Select all edit buttons
  const editButtons = document.querySelectorAll(".edit-btn");

  editButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const taskArticle = btn.closest(".task"); // find the current task container
      const editForm = taskArticle.querySelector(".edit-form");
      const taskBody = taskArticle.querySelector(".task-body");

      // toggle visibility
      const isVisible = editForm.style.display === "block";
      if (isVisible) {
        editForm.style.display = "none";
        taskBody.style.display = "block";
      } else {
        editForm.style.display = "block";
        taskBody.style.display = "none";
      }
    });
  });

  // Cancel edit button
  const cancelButtons = document.querySelectorAll(".cancel-edit");
  cancelButtons.forEach((btn) => {
    btn.addEventListener("click", (e) => {
      const editForm = btn.closest(".edit-form");
      const taskBody = btn.closest(".task").querySelector(".task-body");
      editForm.style.display = "none";
      taskBody.style.display = "block";
    });
  });
</script>

